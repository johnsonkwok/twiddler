<!DOCTYPE html>
<html>
  <head>
    <title>Twiddler</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <style>
      
    </style>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        const $button = $('<button></button>');
        const homeStream = streams.home;
        addHomeTweets();
        
        function addTweets(tweetsArr, idx) {
          var tweet = tweetsArr[idx];
          const timestamp = tweet.created_at.toLocaleTimeString('en-US');
          var $tweet = $('<div></div>');
          const nameDisplay = $('<span></span>').html('<b>' + tweet.user + '</b>');
          nameDisplay.addClass('handle').append(' @' + tweet.user);
          $tweet.prepend(nameDisplay).append('<p>' + tweet.message + '</p>');
          nameDisplay.after('<small> &#8901; ' + timestamp + '</small>');
          $tweet.prependTo($body);
        }

        let currIndex = homeStream.length;
        function addNewTweets() {
          while (currIndex <= homeStream.length - 1) {
            addTweets(homeStream, currIndex);
            currIndex += 1;
            $('#refr').prependTo($body);
          }
        }

        function addHomeTweets() {
          $body.html('');
          var initIndex = 0;
          while (initIndex < homeStream.length) {
            addTweets(homeStream, initIndex);
            initIndex += 1;
          }
          addRefreshBtn();
        }

        function addRefreshBtn() {
          $body.prepend($button);
          $('button').text('Click to refresh Tweets').addClass('btn').attr('id', 'refr');;
          $('#refr').click(addNewTweets);
        }

        function addHomeButton() {
          $button.text('Home').prependTo($body);
          $('button').addClass('btn').attr('id', 'home');
          $('#home').click(addHomeTweets);
        }

        function displayUserTweets(user) {
          $body.empty();
          const userStream = streams.users[user];
          let currUserIdx = 0;
          while (currUserIdx < userStream.length) {
            addTweets(userStream, currUserIdx);
            currUserIdx += 1;
          }
          addHomeButton();
        }

        $body.on('click', '.handle', function() {
          const userToDisplay = $(this).children('b').text();
          displayUserTweets(userToDisplay);
        });

      });

    </script>
  </body>
</html>
